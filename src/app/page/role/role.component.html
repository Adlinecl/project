<div class="page">
    <div class="top"></div>
    <div class="card-container">
        <nz-tabset [nzTabPosition]="'top'" [nzType]="'card'" [(nzSelectedIndex)]="currentTabIndex" (nzSelectChange)="tabChange($event)">
            <nz-tab *ngFor="let tab of tabs" [nzTitle]="tab.name " (nzSelect)="tabSelect(tab.index)">
                <div class="serch-print">
                    <div *ngIf="tab.index == 1">
                        员工姓名
                        <input nz-input placeholder="" nzSize="default" [(ngModel)]="searchItems.name" />
                    </div>
                    <div *ngIf="tab.index == 1">
                        联系电话
                        <input nz-input placeholder="" nzSize="default" [(ngModel)]="searchItems.phone" />
                    </div>
                    <div *ngIf="tab.index == 1">
                        <button nz-button (click)="search()" nzType="primary">查询</button>
                    </div>
                    <div *ngIf="tab.index == 1">
                        <button nz-button (click)="clear()" nzType="default">重置</button>
                    </div>
                    <!-- <div *ngIf="tab.index !== 2 && tab.index !== 3">
                        <button nz-button nzType="danger" (click)="delete()">批量删除</button>
                    </div> -->
                </div>
                <div class="search-table" *ngIf="tab.index == 0">
                    <div class="print">
                        <button (click)="setNew(tab.index, 'add')">
                            <!-- <i nz-icon [nzType]="'plus'"></i> -->
                            <span>新增</span>
                        </button>
                    </div>
                    <nz-table [nzShowTotal]="rangeTemplate" #rowSelectionTable [nzData]="company" [nzPageIndex]='nowPage' [nzTotal]="_total"
                        [nzPageSize]="10" (nzCurrentPageDataChange)="currentPageDataChange($event)" (nzPageSizeChange)="refreshStatus()"
                        (nzPageIndexChange)="pageChange($event)" [nzLoading]="loading">
                        <thead class="table-thead">
                            <tr>

                                <!-- <th>供应商编号</th> -->
                                <th>供应商名称</th>
                                <th>供应商地址</th>
                                <th>联系电话</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of rowSelectionTable.data">
                                <!-- <td>1</td> -->
                                <td>{{data.companyName}}</td>
                                <td>{{data.address}}</td>
                                <td>{{data.phone}}</td>
                                <td>
                                    <a (click)="editPerson(tab.index, data)">编辑</a>&nbsp;&nbsp;&nbsp;
                                    <a (click)="deleteItem(data, tab.index)">删除</a>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>
                <div class="search-table" *ngIf="tab.index == 1">
                    <div class="print">
                        <button (click)="setNew(tab.index)">
                            <!-- <i nz-icon [nzType]="'plus'"></i> -->
                            <span>新增</span>
                        </button>
                    </div>
                    <nz-table [nzShowTotal]="rangeTemplate" #rowSelectionTable [nzData]="users" [nzPageIndex]='nowPage' [nzTotal]="_total" [nzPageSize]="10"
                        (nzCurrentPageDataChange)="currentPageDataChange($event)" (nzPageSizeChange)="refreshStatus()" (nzPageIndexChange)="pageChange($event)"
                        [nzLoading]="loading">
                        <thead class="table-thead">
                            <tr>
                                <th>员工名称</th>
                                <th>员工联系电话</th>
                                <th>年龄</th>
                                <th>性别</th>
                                <th>角色</th>
                                <!-- <th>权限</th> -->
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of rowSelectionTable.data">
                                <td>{{data?.name}}</td>
                                <td>{{data?.phone}}</td>
                                <td>{{data?.age}}</td>
                                <td>{{data?.gender}}</td>
                                <td>
                                    <a (click)="editPerson(tab.index, data)">编辑角色</a>

                                    <!-- <a (click)="look(data)">查看</a>
                                    <div *ngIf="data?.islook">
                                        <div>
                                            <span style="color: red">角色:</span>
                                            <span *ngFor="let item of userRole.roleName">
                                                {{item.roleName}}
                                            </span>
                                        </div> -->
                                    <!-- <div>
                                            <span>权限</span>
                                            <span>111</span>
                                        </div> -->
                                    <!-- </div> -->
                                </td>
                                <td>
                                    <a (click)="deleteItem(data, tab.index)">删除</a>
                                    &nbsp;&nbsp;&nbsp;
                                    <a (click)="editNote(data)">编辑基本信息</a>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>
                <div class="search-table" *ngIf="tab.index == 2">
                    <div class="print ren">
                        <button (click)="setNew(tab.index, 'add')">
                            <!-- <i nz-icon [nzType]="'plus'"></i> -->
                            <span>创建活动</span>
                        </button>
                    </div>
                    <nz-table [nzShowTotal]="rangeTemplate" #rowSelectionTable [nzData]="activityList" [nzPageIndex]='nowPage' [nzTotal]="_total"
                        [nzPageSize]="10" (nzCurrentPageDataChange)="currentPageDataChange($event)" (nzPageSizeChange)="refreshStatus()"
                        (nzPageIndexChange)="pageChange($event)" [nzLoading]="loading">
                        <thead class="table-thead">
                            <tr>
                                <th>活动名称</th>
                                <th>开始时间</th>
                                <th>结束时间</th>
                                <th>折扣</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of rowSelectionTable.data">
                                <td>{{data.name}}</td>
                                <td>{{data.startDate | date: 'yyyy-MM-dd'}}</td>
                                <td>{{data.endDate | date: 'yyyy-MM-dd'}}</td>
                                <td>{{data.discount}}</td>
                                <td>
                                    <a (click)="editPerson(tab.index, data)">编辑</a>&nbsp;&nbsp;&nbsp;
                                    <a (click)="stopclick(data)">{{ EClickType[data.status]}}</a>
                                    &nbsp;&nbsp;&nbsp;
                                    <a (click)="deleteItem(data, tab.index)">删除</a>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>
                <div class="search-table" *ngIf="tab.index == 3">
                    <div class="print">
                        <button (click)="setNew(tab.index, 'add')">
                            <!-- <i nz-icon [nzType]="'plus'"></i> -->
                            <span>创建角色</span>
                        </button>
                    </div>
                    <nz-table [nzShowTotal]="rangeTemplate" #rowSelectionTable [nzData]="roleList" [nzPageIndex]='nowPage' [nzTotal]="_total"
                        [nzPageSize]="10" (nzCurrentPageDataChange)="currentPageDataChange($event)" (nzPageSizeChange)="refreshStatus()"
                        (nzPageIndexChange)="pageChange($event)" [nzLoading]="loading">
                        <thead class="table-thead">
                            <tr>

                                <th>角色名称</th>
                                <th>权限</th>
                                <th>操作</th>

                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of rowSelectionTable.data">
                                <td>{{data.roleName}}</td>
                                <td>
                                    <div *ngFor="let item of data.permissions">
                                        <span> {{item.text}}</span>
                                    </div>

                                </td>
                                <td>
                                    <a (click)="editPerson(tab.index, data)">编辑权限</a>
                                    &nbsp;&nbsp;&nbsp;
                                    <a (click)="deleteItem(data, tab.index)">删除</a>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>
                <!-- </div> -->
            </nz-tab>
        </nz-tabset>
    </div>
</div>
<nz-modal class="popup-module" [(nzVisible)]="isVisible" [nzTitle]="title" [nzContent]="modalContent" [nzFooter]="modalFooter"
    (nzOnCancel)="handleCancel()">
    <form nz-form [formGroup]="surveyForm" (ngSubmit)="submitForm()">
        <ng-template #modalTitle>
            {{title}}
        </ng-template>
        <!-- <input type="hidden" formControlName="id" id="id"> -->
        <ng-template #modalContent>
            <nz-form-item *ngIf="judge == 0">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="companyName">供应商名称</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <input nz-input formControlName="companyName" id="companyName">
                    <nz-form-explain *ngIf="surveyForm.get('companyName').dirty && surveyForm.get('companyName').errors">请填写供应商名称!</nz-form-explain>
                </nz-form-control>
            </nz-form-item>
            <nz-form-item *ngIf="judge == 0">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="address">供应商地址</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <input nz-input formControlName="address" id="address">
                    <nz-form-explain *ngIf="surveyForm.get('address').dirty && surveyForm.get('address').errors">请填写供应商地址!</nz-form-explain>
                </nz-form-control>
            </nz-form-item>
            <nz-form-item *ngIf="judge == 0">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="phone">联系电话</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <input nz-input formControlName="phone" id="phone">
                    <nz-form-explain *ngIf="surveyForm.get('phone').dirty && surveyForm.get('phone').errors">请填写联系电话!</nz-form-explain>
                </nz-form-control>
            </nz-form-item>
            <nz-form-item *ngIf="judge == 1 && !isrole && isadd">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="name">员工姓名</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <input nz-input formControlName="name" id="name">
                    <nz-form-explain *ngIf="surveyForm.get('name').dirty && surveyForm.get('name').errors">请填写地点!</nz-form-explain>
                </nz-form-control>
            </nz-form-item>
            <nz-form-item *ngIf="judge == 1 && !isrole">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="phone">联系电话</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <input nz-input formControlName="phone" id="phone">
                    <nz-form-explain *ngIf="surveyForm.get('phone').dirty && surveyForm.get('phone').errors">请填写地点!</nz-form-explain>
                </nz-form-control>
            </nz-form-item>
            <nz-form-item *ngIf="judge == 1 && !isrole">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="age">年龄</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <input nz-input formControlName="age" id="age">
                    <nz-form-explain *ngIf="surveyForm.get('age').dirty && surveyForm.get('age').errors">请填写地点!</nz-form-explain>
                </nz-form-control>
            </nz-form-item>
            <nz-form-item *ngIf="judge == 1 && !isrole && isadd">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="gender">性别</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <input nz-input formControlName="gender" id="gender">
                    <nz-form-explain *ngIf="surveyForm.get('gender').dirty && surveyForm.get('gender').errors">请填写地点!</nz-form-explain>
                </nz-form-control>
            </nz-form-item>
            <nz-form-item *ngIf="judge == 1 && isdelete">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="roleId">角色</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <nz-select formControlName="roleId" id="roleId" style="width: 200px;height: 30px;" [nzSize]="size" nzMode="multiple" nzPlaceHolder="选择角色">
                        <nz-option *ngFor="let option of roleList" [nzLabel]="option.roleName" [nzValue]="option.id"></nz-option>
                    </nz-select>
                    <nz-form-explain *ngIf="surveyForm.get('roleId').dirty && surveyForm.get('roleId').errors">请选择角色!</nz-form-explain>
                </nz-form-control>
            </nz-form-item>
            <!-- <nz-form-item *ngIf="judge == 1 && isrole">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="roleId">角色</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <nz-select formControlName="roleId" id="roleId" style="width: 200px;height: 30px;" [nzSize]="size" nzMode="multiple" nzPlaceHolder="选择角色">
                        <nz-option *ngFor="let option of roleList" [nzLabel]="option.roleName" [nzValue]="option.id"></nz-option>
                    </nz-select>
                    <nz-form-explain *ngIf="surveyForm.get('roleId').dirty && surveyForm.get('roleId').errors">请选择角色!</nz-form-explain>
                </nz-form-control>
            </nz-form-item> -->
            <!-- <nz-form-item *ngIf="judge == 1">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="name">用户名</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <input nz-input formControlName="name" id="name">
                    <nz-form-explain *ngIf="surveyForm.get('name').dirty && surveyForm.get('name').errors">请填写地点!</nz-form-explain>
                </nz-form-control>
            </nz-form-item> -->
            <!-- <nz-form-item *ngIf="judge == 1">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="name">密码</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <input nz-input formControlName="name" id="name">
                    <nz-form-explain *ngIf="surveyForm.get('name').dirty && surveyForm.get('name').errors">请填写地点!</nz-form-explain>
                </nz-form-control>
            </nz-form-item> -->
            <nz-form-item *ngIf="judge == 2 ">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="name">活动名称</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <input nz-input formControlName="name" id="name">
                    <nz-form-explain *ngIf="surveyForm.get('name').dirty && surveyForm.get('name').errors">请填写活动名称!</nz-form-explain>
                </nz-form-control>
            </nz-form-item>
            <nz-form-item *ngIf="judge == 2 ">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="startDate">开始时间</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <nz-date-picker formControlName="startDate" id="startDate" [(ngModel)]="startDate" (ngModelChange)="onChange($event)"></nz-date-picker>
                    <!-- <input nz-input formControlName="startDate" id="startDate"> -->
                    <nz-form-explain *ngIf="surveyForm.get('startDate').dirty && surveyForm.get('startDate').errors">请填写开始时间!</nz-form-explain>
                </nz-form-control>
            </nz-form-item>
            <nz-form-item *ngIf="judge == 2 ">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="endDate">结束时间</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <nz-date-picker formControlName="endDate" id="endDate" [(ngModel)]="endDate" 
                    (ngModelChange)="onChange($event)"></nz-date-picker>
                    <!-- <input nz-input formControlName="endDate" id="endDate"> -->
                    <nz-form-explain *ngIf="surveyForm.get('endDate').dirty && surveyForm.get('endDate').errors">请填结束时间!</nz-form-explain>
                </nz-form-control>
            </nz-form-item>
            <nz-form-item *ngIf="judge == 2 ">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="discount">折扣</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <input nz-input formControlName="discount" id="discount">
                    <nz-form-explain *ngIf="surveyForm.get('discount').dirty && surveyForm.get('discount').errors">请填写折扣价格!</nz-form-explain>
                </nz-form-control>
            </nz-form-item>
            <nz-form-item *ngIf="judge == 3 && isadd">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="roleName">角色名称</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <input nz-input formControlName="roleName" id="roleName">
                    <nz-form-explain *ngIf="surveyForm.get('roleName').dirty && surveyForm.get('roleName').errors">请填写角色名称!</nz-form-explain>
                </nz-form-control>
            </nz-form-item>
            <nz-form-item *ngIf="judge == 3">
                <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="permissionId">权限</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <nz-select formControlName="permissionId" id="permissionId" style="width: 275px;height: 40px;" [nzSize]="size" nzMode="multiple"
                        nzPlaceHolder="选择权限">
                        <nz-option *ngFor="let option of selectPermissions" [nzLabel]="option.text" [nzValue]="option.id"></nz-option>
                    </nz-select>
                    <nz-form-explain *ngIf="surveyForm.get('permissionId').dirty && surveyForm.get('permissionId').errors">请选择权限!</nz-form-explain>
                </nz-form-control>
            </nz-form-item>
        </ng-template>
        <ng-template #modalFooter>
            <button nz-button nzType="primary" *ngIf="!isadd" (click)="submitForm()" [nzLoading]="isConfirmLoading">保存</button>
            <button nz-button nzType="primary" *ngIf="isadd" (click)="submitForm('add')" [nzLoading]="isConfirmLoading">添加</button>
            <button nz-button nzType="default" class="ant-cancel" (click)="handleCancel()">取消</button>
        </ng-template>
    </form>
</nz-modal>